<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Multithread.js : In-browser multithreading made easy" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Multithread.js</title>
    
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/keithwhor/multithread.js">View on GitHub</a>

          <h1 id="project_title">Multithread.js</h1>
          <h2 id="project_tagline">In-browser multithreading made easy</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/keithwhor/multithread.js/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/keithwhor/multithread.js/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="multithread" class="anchor" href="#multithread"><span class="octicon octicon-link"></span></a>Multithread</h1>

<p>In-browser multithreading made easy.</p>

<p>Run any business logic you like without interrupting the user experience.</p>

<p>Multithread is a simple wrapper that eliminates the hassle of dealing with Web Workers and
transferrable objects.</p>

<p>Run any code you'd like asynchronously, in its own thread, without interrupting the user experience.</p>

<h2>
<a name="using-multithread" class="anchor" href="#using-multithread"><span class="octicon octicon-link"></span></a>Using Multithread</h2>

<p>Using Multithread is simple. Include multithread.js on any page you'd like using</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"my/path/to/multithread.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>And instantiate it in any script tag using</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">num_threads</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MT</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Multithread</span><span class="p">(</span><span class="nx">num_threads</span><span class="p">);</span>
</pre></div>

<p>Multithread will provide the best results when <code>num_threads</code> matches the processor core count of the computer
you're using, but 2-4 threads should always be reasonably speedy.</p>

<h2>
<a name="running-a-thread-asynchronously" class="anchor" href="#running-a-thread-asynchronously"><span class="octicon octicon-link"></span></a>Running a Thread Asynchronously</h2>

<p>The fun stuff! Run any code you want (in the form of a function) asynchronously, in a separate thread like so:</p>

<div class="highlight highlight-js"><pre><span class="nx">MT</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="kd">function</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">argN</span><span class="p">);</span>
</pre></div>

<p>Where <code>function</code> is of the form:</p>

<div class="highlight highlight-js"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="p">...</span> <span class="nx">argN</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* function body */</span>
<span class="p">}</span>
</pre></div>

<p>and <code>callback</code> is of the form:</p>

<div class="highlight highlight-js"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* do something with returnValue in main thread */</span>
<span class="p">}</span>
</pre></div>

<p>Note that <code>.process()</code> itself will return a function object that will not execute until explicitly
told to do so.</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">funcInADifferentThread</span> <span class="o">=</span> <span class="nx">MT</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Nothing has happened,</span>
<span class="c1">//funcInADifferentThread has not executed yet...</span>

<span class="nx">funcInADifferentThread</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Before or after?'</span><span class="p">);</span>

<span class="c1">// We now see "Before or after?" logged in the console,</span>
<span class="c1">// and "3" (= 1 + 2) logged shortly thereafter...</span>
<span class="c1">// it was running asynchronously</span>
</pre></div>

<h2>
<a name="special-data-types" class="anchor" href="#special-data-types"><span class="octicon octicon-link"></span></a>Special Data Types</h2>

<p>Multithread.js uses JSON serialization with <code>.process()</code> so you can deal with your threaded,
asynchronous functions like you'd deal with normal JavaScript functions.</p>

<p>However, optimized support is also provided for typed data, specifically <code>Int32</code> and <code>Float64</code> 
(being signed 32-bit integers and 64-bit floats, respectively).</p>

<p>You can access these using...</p>

<div class="highlight highlight-js"><pre><span class="c1">// Only deal with 32-bit signed integers...</span>
<span class="kd">var</span> <span class="nx">threadedInt32Func</span> <span class="o">=</span> <span class="nx">MT</span><span class="p">.</span><span class="nx">processInt32</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">int32_arg1</span><span class="p">,</span> <span class="nx">int32_arg2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">int32_argN</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* function body */</span>
  <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">int32_returnValue1</span><span class="p">,</span> <span class="nx">int32_returnValue2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">int32_returnValueN</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* main thread callback */</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Only deal with 64-bit floats...</span>
<span class="kd">var</span> <span class="nx">threadedFloat64Func</span> <span class="o">=</span> <span class="nx">MT</span><span class="p">.</span><span class="nx">processFloat64</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">float64_arg1</span><span class="p">,</span> <span class="nx">float64_arg2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">float64_argN</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* function body */</span>
  <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">float64_returnValue1</span><span class="p">,</span> <span class="nx">float64_returnValue2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">float64_returnValueN</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* main thread callback */</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>

<p>You may notice that the threaded functions take an argument list of Int32 and Float64 data,
and the most common use case is more likely an array of data. In this case, feel free to use
Javascript's <code>Function.prototype.apply(context, argArray)</code> to send your array as an argument list.</p>

<div class="highlight highlight-js"><pre><span class="c1">// Use Function.apply to send arguments as an array</span>
<span class="nx">threadedInt32Func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</pre></div>

<p>Note that threaded functions can not have their context set, so the first argument to <code>.apply</code> should
always be <code>null</code>.</p>

<p>Additionally, a keen observer would detect that the <code>callback</code> format is also a little bit different. The return from a <code>.processInt32</code> or <code>.processFloat64</code> threaded function can be a single value or Array.</p>

<p>The arguments sent to <code>callback</code> are the values of a returned array, in order, or just a single argument
representing a single returned value. These values can be accessed via the magic <code>arguments</code> object,
but you may want built-in Array functionality, in which case you can convert this arguments object into
an array:</p>

<div class="highlight highlight-js"><pre><span class="c1">// your callback</span>
<span class="kd">function</span> <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">argumentArray</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="cm">/* do something with your argumentArray here */</span>
<span class="p">}</span>
</pre></div>

<p>That's it! ... Almost.</p>

<h2>
<a name="scope-warning" class="anchor" href="#scope-warning"><span class="octicon octicon-link"></span></a>Scope Warning</h2>

<p>Keep in mind that any threaded function is <strong>completely scope unaware</strong>, meaning something like:</p>

<div class="highlight highlight-js"><pre><span class="kd">function</span> <span class="nx">scopeCheck</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">scopeVar</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">MT</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">scopeVar</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Cool'</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">)();</span>
<span class="p">}</span>
<span class="nx">scopeCheck</span><span class="p">();</span>
</pre></div>

<p>Will throw <code>ReferenceError: scopeVar is not defined</code></p>

<p>However, <strong>callbacks are scope aware</strong> so you needn't be as careful with them.</p>

<h2>
<a name="recursion" class="anchor" href="#recursion"><span class="octicon octicon-link"></span></a>Recursion</h2>

<p>You can accomplish recursion simply by naming your functions as you pass them to Multithread</p>

<div class="highlight highlight-js"><pre><span class="nx">MT</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span>
  <span class="kd">function</span> <span class="nx">Recurse</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Recurse</span><span class="p">(</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">n</span><span class="o">--</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">m</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">)(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// This will increase m twice recursively and log "7"</span>
</pre></div>

<h2>
<a name="limitations" class="anchor" href="#limitations"><span class="octicon octicon-link"></span></a>Limitations</h2>

<p>Be aware of the limitations of multithreading in JavaScript.</p>

<p>All variables passed to functions must be JSON-serializable, meaning only Arrays, Objects, and base types (Number, String, Boolean, null). Same with return variables. No custom objects or prototypes.</p>

<p>Objects and Arrays, as passed to any threaded function, will be deep-copied (passed by value, not reference).</p>

<p>Additionally, threaded functions do not have access to the DOM.</p>

<h2>
<a name="thank-you" class="anchor" href="#thank-you"><span class="octicon octicon-link"></span></a>Thank You</h2>

<p>Thanks, and have fun! :)</p>

<p>Feedback is always appreciated. (Stars, forks, criticisms, you name it!)</p>

<p>You can follow me on twitter at <a href="http://twitter.com/keithwhor">http://twitter.com/keithwhor</a> or visit my website at <a href="http://keithwhor.com/">http://keithwhor.com/</a></p>
      
        
<p><a href="https://twitter.com/keithwhor" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @keithwhor</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Multithread.js maintained by <a href="https://github.com/keithwhor">keithwhor</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-44899638-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
